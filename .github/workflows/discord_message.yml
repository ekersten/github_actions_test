name: DEV Deploy
concurrency: dev-environment-deploy

on:
  push:
    branches:
      - main

jobs:
  deploy_and_notify:

    runs-on: ubuntu-latest

    steps:
    
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Discord notification
      run: |
        # Prepare commit information
        COMMIT_MESSAGE=$(git log --format="%s (%h) de @%an" -n 1 ${{ github.sha }})
        COMMIT_LINK=$(git log --format="[%h](${{ github.event.repository.html_url }}/commit/${{ github.sha }})" -n 1 ${{ github.sha }})

        # Send message to Discord
        curl -X POST -H 'Content-Type: application/json' -d '{
          "content": "New commit(s) on `develop` branch:\n\n'${COMMIT_MESSAGE}' ('${COMMIT_LINK}')"
        }' ${{ secrets.DISCORD_WEBHOOK }}

