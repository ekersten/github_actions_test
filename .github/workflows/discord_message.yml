name: DEV Deploy
concurrency: dev-environment-deploy
# comentario para probar
on: push

jobs:
  deploy_and_notify:

    runs-on: ubuntu-latest

    steps:
    
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Create Changelog
      id: changelog
      uses: actions/github-script@v6
      env:
        COMMITS: ${{ toJSON(github.event.commits) }}
      with:
        script: |
            const commits = JSON.parse(process.env.COMMITS);
            return commits.map(commit => ({
              description: commit.message,
              url: commit.url,
              color: 2664261,
              author: {
                name: commit.author.name,
                url: commit.author.url
              }

            }))
    - name: Discord notification
      env:
        DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        DISCORD_EMBEDS: ${{ steps.changelog.outputs.result }}
      uses: Ilshidur/action-discord@master
      with:
        args: 'Nuevos cambios en https://autonauta.egodesign.dev/'

